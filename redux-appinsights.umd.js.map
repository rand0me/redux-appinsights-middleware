{"version":3,"file":"redux-appinsights.umd.js","sources":["../node_modules/applicationinsights-js/JavaScript/JavaScriptSDK.Module/AppInsightsModule.js","../src/redux-appinsights.ts"],"sourcesContent":["/// <reference path=\"../JavaScriptSDK.Interfaces/IConfig.ts\"/>\r\n/// <reference path=\"../JavaScriptSDK.Interfaces/IAppInsights.ts\"/>\r\ndefine([\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    var AppInsightsModule = (function () {\r\n        function AppInsightsModule() {\r\n        }\r\n        AppInsightsModule._createLazyMethod = function (name) {\r\n            var aiObject = window[AppInsightsModule.appInsightsName];\r\n            // Define a temporary method that queues-up a the real method call\r\n            aiObject[name] = function () {\r\n                // Capture the original arguments passed to the method\r\n                var originalArguments = arguments;\r\n                // If the queue is available, it means that the function wasn't yet replaced with actual function value\r\n                if (aiObject.queue) {\r\n                    aiObject.queue.push(function () { return aiObject[name].apply(aiObject, originalArguments); });\r\n                }\r\n                else {\r\n                    // otherwise execute the function\r\n                    aiObject[name].apply(aiObject, originalArguments);\r\n                }\r\n            };\r\n        };\r\n        ;\r\n        AppInsightsModule._defineLazyMethods = function () {\r\n            var aiObject = window[AppInsightsModule.appInsightsName];\r\n            // capture initial cookie if possible\r\n            try {\r\n                aiObject.cookie = document.cookie;\r\n            }\r\n            catch (e) {\r\n            }\r\n            aiObject.queue = [];\r\n            var method = [\r\n                \"clearAuthenticatedUserContext\",\r\n                \"flush\",\r\n                \"setAuthenticatedUserContext\",\r\n                \"startTrackEvent\",\r\n                \"startTrackPage\",\r\n                \"stopTrackEvent\",\r\n                \"stopTrackPage\",\r\n                \"trackDependency\",\r\n                \"trackEvent\",\r\n                \"trackException\",\r\n                \"trackMetric\",\r\n                \"trackPageView\",\r\n                \"trackTrace\"\r\n            ];\r\n            while (method.length) {\r\n                AppInsightsModule._createLazyMethod(method.pop());\r\n            }\r\n        };\r\n        AppInsightsModule._download = function (aiConfig) {\r\n            AppInsightsModule.appInsightsInstance.config = aiConfig;\r\n            var aiObject = window[AppInsightsModule.appInsightsName];\r\n            // if script was previously downloaded and initialized, queue will be deleted, reinitialize it\r\n            if (!aiObject.queue) {\r\n                aiObject.queue = [];\r\n            }\r\n            setTimeout(function () {\r\n                var scriptElement = document.createElement(\"script\");\r\n                scriptElement.src = aiConfig.url || \"https://az416426.vo.msecnd.net/scripts/a/ai.0.js\";\r\n                document.head.appendChild(scriptElement);\r\n            });\r\n            // collect global errors by wrapping the window.onerror method\r\n            if (!aiConfig.disableExceptionTracking) {\r\n                var method_1 = \"onerror\";\r\n                AppInsightsModule._createLazyMethod(\"_\" + method_1);\r\n                var originalOnError = window[method_1];\r\n                window[method_1] = function (message, url, lineNumber, columnNumber, error) {\r\n                    var handled = originalOnError && originalOnError(message, url, lineNumber, columnNumber, error);\r\n                    if (handled !== true) {\r\n                        aiObject[\"_\" + method_1](message, url, lineNumber, columnNumber, error);\r\n                    }\r\n                    return handled;\r\n                };\r\n            }\r\n        };\r\n        Object.defineProperty(AppInsightsModule, \"appInsightsInstance\", {\r\n            get: function () {\r\n                if (typeof window === 'undefined') {\r\n                    return;\r\n                }\r\n                if (!window[AppInsightsModule.appInsightsName]) {\r\n                    window[AppInsightsModule.appInsightsName] = {\r\n                        downloadAndSetup: AppInsightsModule._download,\r\n                        // exposing it for unit tests only, not part of interface\r\n                        _defineLazyMethods: AppInsightsModule._defineLazyMethods\r\n                    };\r\n                    AppInsightsModule._defineLazyMethods();\r\n                }\r\n                return window[AppInsightsModule.appInsightsName];\r\n            },\r\n            enumerable: true,\r\n            configurable: true\r\n        });\r\n        return AppInsightsModule;\r\n    }());\r\n    AppInsightsModule.appInsightsInitialized = false;\r\n    AppInsightsModule.appInsightsName = \"appInsights\";\r\n    exports.AppInsights = AppInsightsModule.appInsightsInstance;\r\n});\r\n//# sourceMappingURL=AppInsightsModule.js.map","import 'applicationinsights-js'\nimport { Dispatch, Middleware, AnyAction } from 'redux'\n\ntype InsightsEvent = {\n  method: keyof Microsoft.ApplicationInsights.IAppInsights\n  data: any\n}\n\nconst SETUP = 'appinsights/SETUP'\n\nexport function setup(key: string) {\n  return { type: SETUP, payload: key }\n}\n\n/**\n * Middleware's creator\n * @param ai AppInsights instance\n * @param propName Property name to read from your Actions\n */\nexport function createAppInsightsMiddleware(\n  ai: Microsoft.ApplicationInsights.IAppInsights,\n  propName = 'appinsights'\n): Middleware {\n  return ({ dispatch, getState }) => (next: Dispatch<AnyAction>) => (action: AnyAction) => {\n    if (action.type === SETUP && ai.downloadAndSetup) {\n      ai.downloadAndSetup({ instrumentationKey: action.payload })\n    }\n    const params: InsightsEvent = action[propName]\n    if (params) {\n      ;(ai as any)[params.method](...params.data)\n    }\n    next(action)\n  }\n}\n\n/**\n * Reducer's creator\n * @param propName Property name to read from your Actions\n */\nexport function createAppInsightsReducer(propName = 'appinsights') {\n  return (state = { events: [] as InsightsEvent[], key: null }, action: AnyAction) => {\n    if (action[propName]) {\n      return { events: state.events.concat(action[propName]) }\n    } else {\n      return state\n    }\n  }\n}\n"],"names":[],"mappings":"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"}