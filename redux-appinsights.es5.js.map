{"version":3,"file":"redux-appinsights.es5.js","sources":["../node_modules/applicationinsights-js/JavaScript/JavaScriptSDK.Module/AppInsightsModule.js","../src/redux-appinsights.ts"],"sourcesContent":["/// <reference path=\"../JavaScriptSDK.Interfaces/IConfig.ts\"/>\r\n/// <reference path=\"../JavaScriptSDK.Interfaces/IAppInsights.ts\"/>\r\ndefine([\"require\", \"exports\"], function (require, exports) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    var AppInsightsModule = (function () {\r\n        function AppInsightsModule() {\r\n        }\r\n        AppInsightsModule._createLazyMethod = function (name) {\r\n            var aiObject = window[AppInsightsModule.appInsightsName];\r\n            // Define a temporary method that queues-up a the real method call\r\n            aiObject[name] = function () {\r\n                // Capture the original arguments passed to the method\r\n                var originalArguments = arguments;\r\n                // If the queue is available, it means that the function wasn't yet replaced with actual function value\r\n                if (aiObject.queue) {\r\n                    aiObject.queue.push(function () { return aiObject[name].apply(aiObject, originalArguments); });\r\n                }\r\n                else {\r\n                    // otherwise execute the function\r\n                    aiObject[name].apply(aiObject, originalArguments);\r\n                }\r\n            };\r\n        };\r\n        ;\r\n        AppInsightsModule._defineLazyMethods = function () {\r\n            var aiObject = window[AppInsightsModule.appInsightsName];\r\n            // capture initial cookie if possible\r\n            try {\r\n                aiObject.cookie = document.cookie;\r\n            }\r\n            catch (e) {\r\n            }\r\n            aiObject.queue = [];\r\n            var method = [\r\n                \"clearAuthenticatedUserContext\",\r\n                \"flush\",\r\n                \"setAuthenticatedUserContext\",\r\n                \"startTrackEvent\",\r\n                \"startTrackPage\",\r\n                \"stopTrackEvent\",\r\n                \"stopTrackPage\",\r\n                \"trackDependency\",\r\n                \"trackEvent\",\r\n                \"trackException\",\r\n                \"trackMetric\",\r\n                \"trackPageView\",\r\n                \"trackTrace\"\r\n            ];\r\n            while (method.length) {\r\n                AppInsightsModule._createLazyMethod(method.pop());\r\n            }\r\n        };\r\n        AppInsightsModule._download = function (aiConfig) {\r\n            AppInsightsModule.appInsightsInstance.config = aiConfig;\r\n            var aiObject = window[AppInsightsModule.appInsightsName];\r\n            // if script was previously downloaded and initialized, queue will be deleted, reinitialize it\r\n            if (!aiObject.queue) {\r\n                aiObject.queue = [];\r\n            }\r\n            setTimeout(function () {\r\n                var scriptElement = document.createElement(\"script\");\r\n                scriptElement.src = aiConfig.url || \"https://az416426.vo.msecnd.net/scripts/a/ai.0.js\";\r\n                document.head.appendChild(scriptElement);\r\n            });\r\n            // collect global errors by wrapping the window.onerror method\r\n            if (!aiConfig.disableExceptionTracking) {\r\n                var method_1 = \"onerror\";\r\n                AppInsightsModule._createLazyMethod(\"_\" + method_1);\r\n                var originalOnError = window[method_1];\r\n                window[method_1] = function (message, url, lineNumber, columnNumber, error) {\r\n                    var handled = originalOnError && originalOnError(message, url, lineNumber, columnNumber, error);\r\n                    if (handled !== true) {\r\n                        aiObject[\"_\" + method_1](message, url, lineNumber, columnNumber, error);\r\n                    }\r\n                    return handled;\r\n                };\r\n            }\r\n        };\r\n        Object.defineProperty(AppInsightsModule, \"appInsightsInstance\", {\r\n            get: function () {\r\n                if (typeof window === 'undefined') {\r\n                    return;\r\n                }\r\n                if (!window[AppInsightsModule.appInsightsName]) {\r\n                    window[AppInsightsModule.appInsightsName] = {\r\n                        downloadAndSetup: AppInsightsModule._download,\r\n                        // exposing it for unit tests only, not part of interface\r\n                        _defineLazyMethods: AppInsightsModule._defineLazyMethods\r\n                    };\r\n                    AppInsightsModule._defineLazyMethods();\r\n                }\r\n                return window[AppInsightsModule.appInsightsName];\r\n            },\r\n            enumerable: true,\r\n            configurable: true\r\n        });\r\n        return AppInsightsModule;\r\n    }());\r\n    AppInsightsModule.appInsightsInitialized = false;\r\n    AppInsightsModule.appInsightsName = \"appInsights\";\r\n    exports.AppInsights = AppInsightsModule.appInsightsInstance;\r\n});\r\n//# sourceMappingURL=AppInsightsModule.js.map","import 'applicationinsights-js'\nimport { Dispatch, Middleware, AnyAction } from 'redux'\n\ntype InsightsEvent = {\n  method: keyof Microsoft.ApplicationInsights.IAppInsights\n  data: any\n}\n\nconst SETUP = 'appinsights/SETUP'\n\nexport function setup(key: string) {\n  return { type: SETUP, payload: key }\n}\n\n/**\n * Middleware's creator\n * @param ai AppInsights instance\n * @param propName Property name to read from your Actions\n */\nexport function createAppInsightsMiddleware(\n  ai: Microsoft.ApplicationInsights.IAppInsights,\n  propName = 'appinsights'\n): Middleware {\n  return ({ dispatch, getState }) => (next: Dispatch<AnyAction>) => (action: AnyAction) => {\n    if (action.type === SETUP && ai.downloadAndSetup) {\n      ai.downloadAndSetup({ instrumentationKey: action.payload })\n    }\n    const params: InsightsEvent = action[propName]\n    if (params) {\n      ;(ai as any)[params.method](...params.data)\n    }\n    next(action)\n  }\n}\n\n/**\n * Reducer's creator\n * @param propName Property name to read from your Actions\n */\nexport function createAppInsightsReducer(propName = 'appinsights') {\n  return (state = { events: [] as InsightsEvent[], key: null }, action: AnyAction) => {\n    if (action[propName]) {\n      return { events: state.events.concat(action[propName]) }\n    } else {\n      return state\n    }\n  }\n}\n"],"names":[],"mappings":"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"}